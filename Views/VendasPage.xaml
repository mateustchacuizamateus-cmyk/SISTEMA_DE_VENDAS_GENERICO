<Page x:Class="SISTEMA_DE_VENDAS_GENERICO.Views.VendasPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Title="Vendas"
      Background="Transparent">
    
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        
        <!-- Área Principal - Carrinho e Produtos -->
        <Grid Grid.Column="0" Margin="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            
            <!-- Título e Busca -->
            <Border Grid.Row="0" 
                    Background="White" 
                    CornerRadius="5" 
                    Padding="20" 
                    Margin="0,0,0,10">
                <StackPanel>
                    <TextBlock Text="🛒 Nova Venda" 
                               FontSize="20" 
                               FontWeight="Bold" 
                               Foreground="#2C3E50"
                               Margin="0,0,0,15"/>
                    
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <TextBox x:Name="txtBuscaProduto" 
                                 Grid.Column="0"
                                 Height="40" 
                                 FontSize="16"
                                 Padding="10,5"
                                 BorderBrush="#BDC3C7"
                                 BorderThickness="1"
                                 Margin="0,0,10,0"
                                 TextChanged="txtBuscaProduto_TextChanged"
                                 KeyDown="txtBuscaProduto_KeyDown"/>
                        
                        <Button x:Name="btnBuscar" 
                                Grid.Column="1"
                                Content="🔍 Buscar" 
                                Height="40" 
                                Width="100"
                                Background="#3498DB"
                                Foreground="White"
                                FontWeight="Bold"
                                BorderThickness="0"
                                Click="btnBuscar_Click"/>
                    </Grid>
                </StackPanel>
            </Border>
            
            <!-- Lista de Produtos -->
            <Border Grid.Row="1" 
                    Background="White" 
                    CornerRadius="5" 
                    Padding="20" 
                    Margin="0,0,0,10">
                <StackPanel>
                    <TextBlock Text="📦 Produtos Encontrados" 
                               FontSize="16" 
                               FontWeight="Bold" 
                               Foreground="#2C3E50"
                               Margin="0,0,0,10"/>
                    
                    <DataGrid x:Name="dgProdutos" 
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              Height="200"
                              GridLinesVisibility="Horizontal"
                              HeadersVisibility="Column"
                              MouseDoubleClick="dgProdutos_MouseDoubleClick">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Código" 
                                                Binding="{Binding CodigoBarra}" 
                                                Width="100"/>
                            <DataGridTextColumn Header="Produto" 
                                                Binding="{Binding Nome}" 
                                                Width="*"/>
                            <DataGridTextColumn Header="Categoria" 
                                                Binding="{Binding NomeCategoria}" 
                                                Width="120"/>
                            <DataGridTextColumn Header="Preço (AOA)" 
                                                Binding="{Binding PrecoVenda, StringFormat='{}{0:N2} AOA'}" 
                                                Width="120"/>
                            <DataGridTextColumn Header="Estoque" 
                                                Binding="{Binding EstoqueAtual}" 
                                                Width="80"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>
            </Border>
            
            <!-- Carrinho de Compras -->
            <Border Grid.Row="2" 
                    Background="White" 
                    CornerRadius="5" 
                    Padding="20">
                <StackPanel>
                    <TextBlock Text="🛍️ Carrinho de Compras" 
                               FontSize="16" 
                               FontWeight="Bold" 
                               Foreground="#2C3E50"
                               Margin="0,0,0,10"/>
                    
                    <DataGrid x:Name="dgCarrinho" 
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              Height="250"
                              GridLinesVisibility="Horizontal"
                              HeadersVisibility="Column">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Produto" 
                                                Binding="{Binding NomeProduto}" 
                                                Width="*"/>
                            <DataGridTextColumn Header="Qtd" 
                                                Binding="{Binding Quantidade}" 
                                                Width="60"/>
                            <DataGridTextColumn Header="Preço Unit. (AOA)" 
                                                Binding="{Binding PrecoUnitario, StringFormat='{}{0:N2} AOA'}" 
                                                Width="120"/>
                            <DataGridTextColumn Header="Total (AOA)" 
                                                Binding="{Binding TotalItem, StringFormat='{}{0:N2} AOA'}" 
                                                Width="120"/>
                            <DataGridTemplateColumn Header="Ações" Width="80">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Content="❌" 
                                                Background="#E74C3C"
                                                Foreground="White"
                                                BorderThickness="0"
                                                Padding="5"
                                                Click="btnRemoverItem_Click"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>
            </Border>
        </Grid>
        
        <!-- Área Lateral - Finalização -->
        <Border Grid.Column="1" 
                Background="White" 
                CornerRadius="5" 
                Margin="10,10,10,10"
                Padding="20">
            <StackPanel>
                <TextBlock Text="💰 Finalizar Venda" 
                           FontSize="18" 
                           FontWeight="Bold" 
                           Foreground="#2C3E50"
                           Margin="0,0,0,20"/>
                
                <!-- Cliente -->
                <TextBlock Text="Cliente (Opcional):" 
                           FontSize="14" 
                           Foreground="#2C3E50"
                           Margin="0,0,0,5"/>
                <ComboBox x:Name="cmbClientes" 
                          Height="35" 
                          FontSize="14"
                          Margin="0,0,0,15"/>
                
                <!-- Subtotal -->
                <Grid Margin="0,0,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" 
                               Text="Subtotal:" 
                               FontSize="16" 
                               FontWeight="Bold"/>
                    <TextBlock Grid.Column="1" 
                               x:Name="txtSubtotal" 
                               Text="0,00 AOA" 
                               FontSize="16" 
                               FontWeight="Bold"
                               Foreground="#3498DB"/>
                </Grid>
                
                <!-- Desconto -->
                <Grid Margin="0,0,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" 
                               Text="Desconto:" 
                               FontSize="16" 
                               FontWeight="Bold"/>
                    <TextBox Grid.Column="1" 
                             x:Name="txtDesconto" 
                             Text="0,00" 
                             Width="100"
                             FontSize="16"
                             TextAlignment="Right"
                             TextChanged="txtDesconto_TextChanged"/>
                </Grid>
                
                <!-- Forma de Pagamento -->
                <TextBlock Text="Forma de Pagamento:" 
                           FontSize="14" 
                           Foreground="#2C3E50"
                           Margin="0,15,0,5"/>
                <ComboBox x:Name="cmbFormaPagamento" 
                          Height="35" 
                          FontSize="14"
                          Margin="0,0,0,15"/>
                
                <!-- Total -->
                <Border Background="#ECF0F1" 
                        CornerRadius="5" 
                        Padding="15" 
                        Margin="0,10,0,20">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" 
                                   Text="TOTAL:" 
                                   FontSize="18" 
                                   FontWeight="Bold"
                                   Foreground="#2C3E50"/>
                        <TextBlock Grid.Column="1" 
                                   x:Name="txtTotal" 
                                   Text="0,00 AOA" 
                                   FontSize="20" 
                                   FontWeight="Bold"
                                   Foreground="#E74C3C"/>
                    </Grid>
                </Border>
                
                <!-- Botões -->
                <StackPanel Orientation="Horizontal" 
                           HorizontalAlignment="Center" 
                           Margin="0,20,0,0">
                    <Button x:Name="btnFinalizarVenda" 
                            Content="✅ Finalizar Venda" 
                            Height="45" 
                            Width="150"
                            Background="#27AE60"
                            Foreground="White"
                            FontWeight="Bold"
                            FontSize="14"
                            BorderThickness="0"
                            Margin="0,0,10,0"
                            Click="btnFinalizarVenda_Click"/>
                    
                    <Button x:Name="btnCancelarVenda" 
                            Content="❌ Cancelar" 
                            Height="45" 
                            Width="120"
                            Background="#E74C3C"
                            Foreground="White"
                            FontWeight="Bold"
                            FontSize="14"
                            BorderThickness="0"
                            Click="btnCancelarVenda_Click"/>
                </StackPanel>
                
                <!-- Observações -->
                <TextBlock Text="Observações:" 
                           FontSize="14" 
                           Foreground="#2C3E50"
                           Margin="0,20,0,5"/>
                <TextBox x:Name="txtObservacoes" 
                         Height="60" 
                         FontSize="14"
                         TextWrapping="Wrap"
                         AcceptsReturn="True"
                         VerticalScrollBarVisibility="Auto"
                         Margin="0,0,0,10"/>
            </StackPanel>
        </Border>
    </Grid>
</Page> 